extends ../layout.pug

block content
  h2.mb-4 Listado de Mascotas

  // Botones Nueva Mascota, nuevo cliente e Inicio
  .d-flex.mb-3
    a.btn.btn-nuevo.me-2(href="/mascotas/nuevo")
      i.bi.bi-plus-circle
      |  Nueva Mascota

    a.btn.btn-nuevo.me-2(href="/clientes/nuevo")
      i.bi.bi-person-plus-fill
      |  Nuevo Cliente

    a.btn.btn-secondary(href="/dashboard")
      i.bi.bi-house
      |  Inicio


  if mascotas && mascotas.length
    table.table.table-striped.table-bordered
      thead
        tr
          th ID
          th Nombre
          th Especie
          th Raza
          th Sexo
          th Edad
          th Peso
          th Primera Consulta
          th Dueño
          th Chip
          th Observaciones
          th Acciones
      tbody
        each mascota in mascotas
          tr
            td= mascota.mascotaId
            td= mascota.nombre
            td= mascota.especie
            td= mascota.raza || "-"
            td= mascota.sexo
            td= mascota.edad + ' años'
            td= mascota.peso ? mascota.peso + ' kg' : '-'
            td= mascota.fechaPrimeraConsulta ? new Date(mascota.fechaPrimeraConsulta).toLocaleDateString('es-ES') : "-"
            td= mascota.cliente ? mascota.cliente.nombre + " " + mascota.cliente.apellido : "Sin dueño"
            td= mascota.chip || "-"
            td= mascota.observaciones || "-"
            td
                a.btn.btn-acciones.editar(href="/mascotas/editar/" + mascota._id)
                  i.bi.bi-pencil-fill
                button.btn.btn-acciones.eliminar.btn-eliminar(data-id=mascota._id)
                  i.bi.bi-trash-fill

  else
    p.text-center.mt-4 No hay mascotas registradas.

block scripts
  script(src="https://cdn.jsdelivr.net/npm/sweetalert2@11")
  script.
    document.querySelectorAll(".btn-eliminar").forEach(btn => {
      btn.addEventListener("click", function () {
        const id = this.getAttribute("data-id");

        Swal.fire({
          title: "¿Eliminar Mascota?",
          text: "Esta acción no se puede deshacer",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#9A4475",
          cancelButtonColor: "#E49AC3",
          confirmButtonText: "Sí, eliminar",
          cancelButtonText: "Cancelar"
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = `/mascotas/eliminar/${id}`;
          }
        });
      });
    });
